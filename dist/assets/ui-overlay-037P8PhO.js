import{c as e,b as n,e as t,S as o,k as s,d as a,U as i,R as l,z as r,K as d,h as c,X as u,T as h,L as f,G as v,a as p,w as m,x as g,H as b,A as C,p as k,Y as y,f as w,I as A,F as O,J as R}from"./vendor-BseUHsTR.js";import{z as F,A as S,B as x,d as B,C as L,D as E,E as j,S as P,F as M,G as $,H as D,c as N,a as T,I as z,J as I,n as q,u as H,K as U,L as K,s as X,M as Y}from"./ui-misc-BIs87odC.js";import{c as G,a as J,N as V,d as W}from"./ui-core-DG87wseb.js";import{k as Q,o as Z,z as _,A as ee,q as ne,n as te,i as oe,l as se,t as ae}from"./vendor-libs-DuKgFuhX.js";const ie=e("n-drawer-body"),le=e("n-modal-body"),re=e("n-modal-provider"),de=e("n-modal"),ce=e("n-popover-body"),ue=F({name:"Modal",common:B,peers:{Scrollbar:x,Dialog:S,Card:G},self:function(e){const{modalColor:n,textColor2:t,boxShadow3:o}=e;return{color:n,textColor:t,boxShadow:o}}}),he=e("n-modal-provider"),fe=e("n-modal-api"),ve=e("n-modal-reactive-list");function pe(){const e=n(fe,null);return null===e&&L("use-modal","No outer <n-modal-provider /> founded."),e}const me="n-draggable",ge=Object.assign(Object.assign({},J),E),be=s(ge),Ce=a({name:"ModalBody",inheritAttrs:!1,slots:Object,props:Object.assign(Object.assign({show:{type:Boolean,required:!0},preset:String,displayDirective:{type:String,required:!0},trapFocus:{type:Boolean,default:!0},autoFocus:{type:Boolean,default:!0},blockScroll:Boolean,draggable:{type:[Boolean,Object],default:!1}},ge),{renderMask:Function,onClickoutside:Function,onBeforeLeave:{type:Function,required:!0},onAfterLeave:{type:Function,required:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0},onClose:{type:Function,required:!0},onAfterEnter:Function,onEsc:Function}),setup(e){const s=p(null),a=p(null),i=p(e.show),l=p(null),r=p(null),d=n(de);let c=null;m(g(e,"show"),e=>{e&&(c=d.getMousePosition())},{immediate:!0});const{stopDrag:u,startDrag:h,draggableRef:f,draggableClassRef:v}=function(e,n){let s;const a=t(()=>!1!==e.value),i=t(()=>a.value?me:""),l=t(()=>{const n=e.value;return!0===n||!1===n||!n||"none"!==n.bounds});function r(){s&&(s(),s=void 0)}return o(r),{stopDrag:r,startDrag:function(e){const t=e.querySelector(`.${me}`);if(!t||!i.value)return;let o,a=0,r=0,d=0,c=0,u=0,h=0;function f(n){n.preventDefault(),o=n;const{x:t,y:s,right:i,bottom:l}=e.getBoundingClientRect();r=t,c=s,a=window.innerWidth-i,d=window.innerHeight-l;const{left:f,top:v}=e.style;u=+v.slice(0,-2),h=+f.slice(0,-2)}function v(n){if(!o)return;const{clientX:t,clientY:s}=o;let i=n.clientX-t,f=n.clientY-s;l.value&&(i>a?i=a:-i>r&&(i=-r),f>d?f=d:-f>c&&(f=-c));const v=i+h,p=f+u;e.style.top=`${p}px`,e.style.left=`${v}px`}function p(){o=void 0,n.onEnd(e)}Q("mousedown",t,f),Q("mousemove",window,v),Q("mouseup",window,p),s=()=>{Z("mousedown",t,f),Q("mousemove",window,v),Q("mouseup",window,p)}},draggableRef:a,draggableClassRef:i}}(g(e,"draggable"),{onEnd:e=>{O(e)}}),y=t(()=>b([e.titleClass,v.value])),w=t(()=>b([e.headerClass,v.value]));function A(){if("center"===d.transformOriginRef.value)return"";const{value:e}=l,{value:n}=r;return null===e||null===n?"":a.value?`${e}px ${n+a.value.containerScrollTop}px`:""}function O(e){if("center"===d.transformOriginRef.value)return;if(!c)return;if(!a.value)return;const n=a.value.containerScrollTop,{offsetLeft:t,offsetTop:o}=e,s=c.y,i=c.x;l.value=-(t-i),r.value=-(o-s-n),e.style.transformOrigin=A()}m(g(e,"show"),e=>{e&&(i.value=!0)}),$(t(()=>e.blockScroll&&i.value));const R=p(null);return m(R,e=>{e&&C(()=>{const n=e.el;n&&s.value!==n&&(s.value=n)})}),k(le,s),k(ie,null),k(ce,null),{mergedTheme:d.mergedThemeRef,appear:d.appearRef,isMounted:d.isMountedRef,mergedClsPrefix:d.mergedClsPrefixRef,bodyRef:s,scrollbarRef:a,draggableClass:v,displayed:i,childNodeRef:R,cardHeaderClass:w,dialogTitleClass:y,handlePositiveClick:function(){e.onPositiveClick()},handleNegativeClick:function(){e.onNegativeClick()},handleCloseClick:function(){const{onClose:n}=e;n&&n()},handleAfterEnter:function(n){const t=n;f.value&&h(t),e.onAfterEnter&&e.onAfterEnter(t)},handleAfterLeave:function(){i.value=!1,l.value=null,r.value=null,u(),e.onAfterLeave()},handleBeforeLeave:function(n){n.style.transformOrigin=A(),e.onBeforeLeave()},handleEnter:function(e){C(()=>{O(e)})}}},render(){const{$slots:e,$attrs:n,handleEnter:t,handleAfterEnter:o,handleAfterLeave:s,handleBeforeLeave:a,preset:p,mergedClsPrefix:m}=this;let g=null;if(!p){if(g=i("default",e.default,{draggableClass:this.draggableClass}),!g)return void j("modal","default slot is empty");g=l(g),g.props=r({class:`${m}-modal`},n,g.props||{})}return"show"===this.displayDirective||this.displayed||this.show?d(c("div",{role:"none",class:`${m}-modal-body-wrapper`},c(P,{ref:"scrollbarRef",theme:this.mergedTheme.peers.Scrollbar,themeOverrides:this.mergedTheme.peerOverrides.Scrollbar,contentClass:`${m}-modal-scroll-content`},{default:()=>{var n;return[null===(n=this.renderMask)||void 0===n?void 0:n.call(this),c(u,{disabled:!this.trapFocus,active:this.show,onEsc:this.onEsc,autoFocus:this.autoFocus},{default:()=>{var n;return c(h,{name:"fade-in-scale-up-transition",appear:null!==(n=this.appear)&&void 0!==n?n:this.isMounted,onEnter:t,onAfterEnter:o,onAfterLeave:s,onBeforeLeave:a},{default:()=>{const n=[[f,this.show]],{onClickoutside:t}=this;return t&&n.push([_,this.onClickoutside,void 0,{capture:!0}]),d("confirm"===this.preset||"dialog"===this.preset?c(M,Object.assign({},this.$attrs,{class:[`${m}-modal`,this.$attrs.class],ref:"bodyRef",theme:this.mergedTheme.peers.Dialog,themeOverrides:this.mergedTheme.peerOverrides.Dialog},v(this.$props,D),{titleClass:this.dialogTitleClass,"aria-modal":"true"}),e):"card"===this.preset?c(V,Object.assign({},this.$attrs,{ref:"bodyRef",class:[`${m}-modal`,this.$attrs.class],theme:this.mergedTheme.peers.Card,themeOverrides:this.mergedTheme.peerOverrides.Card},v(this.$props,W),{headerClass:this.cardHeaderClass,"aria-modal":"true",role:"dialog"}),e):this.childNodeRef=g,n)}})}})]}})),[[f,"if"===this.displayDirective||this.displayed||this.show]]):null}}),ke=N([T("modal-container","\n position: fixed;\n left: 0;\n top: 0;\n height: 0;\n width: 0;\n display: flex;\n "),T("modal-mask","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n background-color: rgba(0, 0, 0, .4);\n ",[z({enterDuration:".25s",leaveDuration:".25s",enterCubicBezier:"var(--n-bezier-ease-out)",leaveCubicBezier:"var(--n-bezier-ease-out)"})]),T("modal-body-wrapper","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n overflow: visible;\n ",[T("modal-scroll-content","\n min-height: 100%;\n display: flex;\n position: relative;\n ")]),T("modal","\n position: relative;\n align-self: center;\n color: var(--n-text-color);\n margin: auto;\n box-shadow: var(--n-box-shadow);\n ",[I({duration:".25s",enterScale:".5"}),N(`.${me}`,"\n cursor: move;\n user-select: none;\n ")])]),ye=Object.assign(Object.assign(Object.assign(Object.assign({},H.props),{show:Boolean,unstableShowMask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},preset:String,to:[String,Object],displayDirective:{type:String,default:"if"},transformOrigin:{type:String,default:"mouse"},zIndex:Number,autoFocus:{type:Boolean,default:!0},trapFocus:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!0}}),ge),{draggable:[Boolean,Object],onEsc:Function,"onUpdate:show":[Function,Array],onUpdateShow:[Function,Array],onAfterEnter:Function,onBeforeLeave:Function,onAfterLeave:Function,onClose:Function,onPositiveClick:Function,onNegativeClick:Function,onMaskClick:Function,internalDialog:Boolean,internalModal:Boolean,internalAppear:{type:Boolean,default:void 0},overlayStyle:[String,Object],onBeforeHide:Function,onAfterHide:Function,onHide:Function}),we=a({name:"Modal",inheritAttrs:!1,props:ye,slots:Object,setup(e){const o=p(null),{mergedClsPrefixRef:s,namespaceRef:a,inlineThemeDisabled:i}=q(e),l=H("Modal","-modal",ke,ue,e,s),r=ne(64),d=te(),c=oe(),u=e.internalDialog?n(U,null):null,h=e.internalModal?n(re,null):null,f=K();function m(n){const{onUpdateShow:t,"onUpdate:show":o,onHide:s}=e;t&&w(t,n),o&&w(o,n),s&&!n&&s(n)}k(de,{getMousePosition:()=>{const e=u||h;if(e){const{clickedRef:n,clickedPositionRef:t}=e;if(n.value&&t.value)return t.value}return r.value?d.value:null},mergedClsPrefixRef:s,mergedThemeRef:l,isMountedRef:c,appearRef:g(e,"internalAppear"),transformOriginRef:g(e,"transformOrigin")});const b=t(()=>{const{common:{cubicBezierEaseOut:e},self:{boxShadow:n,color:t,textColor:o}}=l.value;return{"--n-bezier-ease-out":e,"--n-box-shadow":n,"--n-color":t,"--n-text-color":o}}),C=i?X("theme-class",void 0,b,e):void 0;return{mergedClsPrefix:s,namespace:a,isMounted:c,containerRef:o,presetProps:t(()=>v(e,be)),handleEsc:function(n){var t;null===(t=e.onEsc)||void 0===t||t.call(e),e.show&&e.closeOnEsc&&Y(n)&&(f.value||m(!1))},handleAfterLeave:function(){const{onAfterLeave:n,onAfterHide:t}=e;n&&w(n),t&&t()},handleClickoutside:function(n){var t;const{onMaskClick:s}=e;s&&s(n),e.maskClosable&&(null===(t=o.value)||void 0===t?void 0:t.contains(se(n)))&&m(!1)},handleBeforeLeave:function(){const{onBeforeLeave:n,onBeforeHide:t}=e;n&&w(n),t&&t()},doUpdateShow:m,handleNegativeClick:function(){const{onNegativeClick:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&m(!1)}):m(!1)},handlePositiveClick:function(){const{onPositiveClick:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&m(!1)}):m(!1)},handleCloseClick:function(){const{onClose:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&m(!1)}):m(!1)},cssVars:i?void 0:b,themeClass:null==C?void 0:C.themeClass,onRender:null==C?void 0:C.onRender}},render(){const{mergedClsPrefix:e}=this;return c(y,{to:this.to,show:this.show},{default:()=>{var n;null===(n=this.onRender)||void 0===n||n.call(this);const{unstableShowMask:t}=this;return d(c("div",{role:"none",ref:"containerRef",class:[`${e}-modal-container`,this.themeClass,this.namespace],style:this.cssVars},c(Ce,Object.assign({style:this.overlayStyle},this.$attrs,{ref:"bodyWrapper",displayDirective:this.displayDirective,show:this.show,preset:this.preset,autoFocus:this.autoFocus,trapFocus:this.trapFocus,draggable:this.draggable,blockScroll:this.blockScroll},this.presetProps,{onEsc:this.handleEsc,onClose:this.handleCloseClick,onNegativeClick:this.handleNegativeClick,onPositiveClick:this.handlePositiveClick,onBeforeLeave:this.handleBeforeLeave,onAfterEnter:this.onAfterEnter,onAfterLeave:this.handleAfterLeave,onClickoutside:t?void 0:this.handleClickoutside,renderMask:t?()=>{var n;return c(h,{name:"fade-in-transition",key:"mask",appear:null!==(n=this.internalAppear)&&void 0!==n?n:this.isMounted},{default:()=>this.show?c("div",{"aria-hidden":!0,ref:"containerRef",class:`${e}-modal-mask`,onClick:this.handleClickoutside}):null})}:void 0}),this.$slots)),[[ee,{zIndex:this.zIndex,enabled:this.show}]])}})}}),Ae=a({name:"ModalEnvironment",props:Object.assign(Object.assign({},ye),{internalKey:{type:String,required:!0},onInternalAfterLeave:{type:Function,required:!0}}),setup(e){const n=p(!0);function t(){n.value=!1}return{show:n,hide:t,handleUpdateShow:function(e){n.value=e},handleAfterLeave:function(){const{onInternalAfterLeave:n,internalKey:t,onAfterLeave:o}=e;n&&n(t),o&&o()},handleCloseClick:function(){const{onClose:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&t()}):t()},handleNegativeClick:function(){const{onNegativeClick:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&t()}):t()},handlePositiveClick:function(){const{onPositiveClick:n}=e;n?Promise.resolve(n()).then(e=>{!1!==e&&t()}):t()},handleMaskClick:function(n){const{onMaskClick:o,maskClosable:s}=e;o&&(o(n),s&&t())},handleEsc:function(){const{onEsc:n}=e;n&&n()}}},render(){const{handleUpdateShow:e,handleAfterLeave:n,handleMaskClick:t,handleEsc:o,show:s}=this;return c(we,Object.assign({},this.$props,{show:s,onUpdateShow:e,onMaskClick:t,onEsc:o,onAfterLeave:n,internalAppear:!0,internalModal:!0}))}}),Oe=a({name:"ModalProvider",props:{to:[String,Object]},setup(){const e=p([]),n={},t={create:function(t={}){const o=ae(),s=R(Object.assign(Object.assign({},t),{key:o,destroy:()=>{var e;null===(e=n[`n-modal-${o}`])||void 0===e||e.hide()}}));return e.value.push(s),s},destroyAll:function(){Object.values(n).forEach(e=>{null==e||e.hide()})}};return k(fe,t),k(he,{clickedRef:ne(64),clickedPositionRef:te()}),k(ve,e),Object.assign(Object.assign({},t),{modalList:e,modalInstRefs:n,handleAfterLeave:function(n){const{value:t}=e;t.splice(t.findIndex(e=>e.key===n),1)}})},render(){var e,n;return c(O,null,[this.modalList.map(e=>{var n;return c(Ae,A(e,["destroy"],{to:null!==(n=e.to)&&void 0!==n?n:this.to,ref:n=>{null===n?delete this.modalInstRefs[`n-modal-${e.key}`]:this.modalInstRefs[`n-modal-${e.key}`]=n},internalKey:e.key,onInternalAfterLeave:this.handleAfterLeave}))}),null===(n=(e=this.$slots).default)||void 0===n?void 0:n.call(e)])}});export{we as N,Oe as a,pe as u};
