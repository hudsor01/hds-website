---
phase: 49-e2e-test-suite
plan: 01
type: execute
---

<objective>
Create E2E tests for tool generator pages and location pages — the critical gaps in the existing Playwright suite.

Purpose: The existing E2E suite covers contact form, homepage, /services, /pricing, /blog, /about — but has zero coverage for the 13 tool pages (paystub was skipped after route rename) or the 75 location pages added in Phase 48. These are the site's core "product" pages.
Output: e2e/tools.spec.ts (tools index + paystub + invoice + contract generators), e2e/locations.spec.ts (/locations index + one slug page)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/48-national-location-pages/48-01-SUMMARY.md

**Current state (discovered during planning):**
- Playwright 1.58.2 installed; `playwright.config.ts` configured (port 3001, auto-starts dev server, chromium + webkit projects)
- Existing specs: contact-form.spec.ts, user-flows-validation.spec.ts, user-flows-secondary.spec.ts, dark-mode, mobile, newsletter, visual-css, visual-regression
- Paystub test exists in user-flows-validation.spec.ts but is SKIPPED (`test.describe.skip`) — route was /paystub-generator, now /tools/paystub-calculator
- No tests for: /tools index, any /tools/* generators, /locations, /locations/[slug]
- Run command: `bun run test:e2e:fast` (chromium only, fastest)

**Key file/URL references:**
@playwright.config.ts
@e2e/contact-form.spec.ts
@e2e/user-flows-validation.spec.ts
@src/lib/constants/routes.ts

**Tool routes (from TOOL_ROUTES constants):**
- /tools — index listing all 13 tools
- /tools/paystub-calculator — PaystubCalculatorClient renders form with employee info fields
- /tools/invoice-generator — InvoiceGeneratorClient with line items, client name, etc.
- /tools/contract-generator — ContractGeneratorClient with parties, scope, terms

**Location routes (built in Phase 48):**
- /locations — index with 11 state sections, each with city links (MapPin icons)
- /locations/dallas-tx — representative Texas location slug

**Constraining decisions:**
- Use accessible selectors (role, label text) over data-testid per existing test patterns
- Smoke test level: verify page loads, h1 present, key elements visible — NOT full form submission or PDF generation
- Follow existing spec file style (import { test, expect } from '@playwright/test'; test.describe pattern)
- baseURL is 'http://localhost:3001' per playwright.config.ts
- DO NOT use waitForTimeout (flaky) — prefer waitForLoadState('networkidle') or element wait
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create e2e/tools.spec.ts — tools index and generator pages</name>
  <files>e2e/tools.spec.ts</files>
  <action>
    Create `e2e/tools.spec.ts` with 4 test suites:

    **Suite 1: /tools index page**
    - Navigates to /tools
    - Verifies h1 with "Free Business Tools" text visible
    - Verifies at least 10 tool cards are present (grid of cards)
    - Verifies each card has a link pointing to /tools/...

    **Suite 2: /tools/paystub-calculator**
    - Navigates to /tools/paystub-calculator
    - Waits for page to be interactive (the client component uses dynamic import)
    - Verifies h1 or page heading contains "Paystub" (case-insensitive)
    - Verifies at least one input field is visible

    **Suite 3: /tools/invoice-generator**
    - Navigates to /tools/invoice-generator
    - Waits for interactive state
    - Verifies page heading contains "Invoice" (case-insensitive)
    - Verifies at least one input field or button is visible

    **Suite 4: /tools/contract-generator**
    - Navigates to /tools/contract-generator
    - Waits for interactive state
    - Verifies page heading contains "Contract" (case-insensitive)
    - Verifies at least one input field or button is visible

    Use `page.waitForLoadState('networkidle')` after navigation (client components hydrate asynchronously).
    Use `page.locator('h1, h2, h3').filter({ hasText: /pattern/i }).first()` for flexible heading detection.
    Use `page.locator('input, textarea').first()` for input presence checks.

    Example structure:
    ```typescript
    import { test, expect } from '@playwright/test'

    test.describe('Tools Index', () => {
      test('should display all tool cards', async ({ page }) => {
        await page.goto('/tools')
        await page.waitForLoadState('networkidle')
        await expect(page.locator('h1')).toBeVisible()
        const toolLinks = page.locator('a[href^="/tools/"]')
        await expect(toolLinks).toHaveCount(13) // exactly 13 from TOOL_ROUTES
      })
    })
    ```
  </action>
  <verify>bun run test:e2e:fast -- tools.spec.ts 2>&1 | tail -20</verify>
  <done>
    - e2e/tools.spec.ts exists
    - All 4 suites present (tools index + 3 generators)
    - Tests pass (0 fail) when run with bun run test:e2e:fast -- tools.spec.ts
    - No TypeScript errors (tsc --noEmit passes)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create e2e/locations.spec.ts — locations index and slug page</name>
  <files>e2e/locations.spec.ts</files>
  <action>
    Create `e2e/locations.spec.ts` with 2 test suites:

    **Suite 1: /locations index page**
    - Navigates to /locations
    - Verifies h1 contains "Serving Businesses" or "Locations" (case-insensitive)
    - Verifies at least 11 state section headings (h2 elements) are present
    - Verifies at least 75 city links are present (each is an anchor with /locations/ href)
    - Verifies the CTA link to /contact is present

    **Suite 2: /locations/dallas-tx (representative slug)**
    - Navigates to /locations/dallas-tx
    - Verifies page loads (does not 404 — check no 'not found' text)
    - Verifies h1 contains "Dallas" (case-insensitive)
    - Verifies a link back to /locations is present (breadcrumb)

    Use `page.locator('h2').count()` for state section count.
    Use `page.locator('a[href^="/locations/"]').count()` for city link count.

    Example structure:
    ```typescript
    import { test, expect } from '@playwright/test'

    test.describe('Locations Index', () => {
      test('should display all 11 state sections', async ({ page }) => {
        await page.goto('/locations')
        await page.waitForLoadState('networkidle')
        await expect(page.locator('h1')).toBeVisible()
        const stateSections = page.locator('h2')
        expect(await stateSections.count()).toBeGreaterThanOrEqual(11)
        const cityLinks = page.locator('a[href^="/locations/"]')
        expect(await cityLinks.count()).toBeGreaterThanOrEqual(75)
      })
    })
    ```
  </action>
  <verify>bun run test:e2e:fast -- locations.spec.ts 2>&1 | tail -20</verify>
  <done>
    - e2e/locations.spec.ts exists
    - Both suites present (index + dallas-tx slug)
    - Tests pass (0 fail) when run with bun run test:e2e:fast -- locations.spec.ts
    - No TypeScript errors
    - bun test tests/ still shows 329 pass (no unit test regression)
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] bun run typecheck — 0 errors
- [ ] bun run lint — 0 errors
- [ ] bun test tests/ — 329 pass, 0 fail (unit tests unaffected)
- [ ] bun run test:e2e:fast -- tools.spec.ts — all tests pass
- [ ] bun run test:e2e:fast -- locations.spec.ts — all tests pass
- [ ] e2e/tools.spec.ts covers: /tools, /tools/paystub-calculator, /tools/invoice-generator, /tools/contract-generator
- [ ] e2e/locations.spec.ts covers: /locations, /locations/dallas-tx
</verification>

<success_criteria>
- e2e/tools.spec.ts: 4 test suites, all passing
- e2e/locations.spec.ts: 2 test suites, all passing
- Zero TypeScript errors, zero ESLint errors
- 329 unit tests continue to pass
- No regressions in existing E2E specs
</success_criteria>

<output>
After completion, create `.planning/phases/49-e2e-test-suite/49-01-SUMMARY.md` and update STATE.md and ROADMAP.md.
</output>
