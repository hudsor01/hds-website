---
phase: 17-nextjs-alignment
plan: 01
status: pending
---

# Plan: Next.js 16 Alignment Fixes

## Context

The project runs Next.js 16.1.6 with React 19.2.4. A structural review against Next.js 16 official documentation identified 7 optimization opportunities. This plan addresses the high-priority issues.

## Scope

| Item | Priority | Description |
|------|----------|-------------|
| 1. Remove `'use server'` from request.ts | **Critical** | Security: all exports become callable Server Functions |
| 2. Delete global-not-found.tsx | High | Dead code: not a valid Next.js file convention |
| 3. Add loading.tsx to dynamic routes | Medium | UX: streaming loading states for admin, portfolio, testimonials, help, tools |
| 4. Clean root layout `<head>` duplication | Low | Maintenance: duplicate entries in Metadata API and manual `<head>` |
| 5. Remove redundant tsconfig path aliases | Low | Cleanup: unnecessary aliases for paths that don't exist |

**Deferred (optional):**
- React Compiler (experimental, not stable)
- cacheComponents (experimental)

## Tasks

### 1. Fix request.ts security issue
**File**: `src/lib/request.ts`
**Issue**: Has `'use server'` at top, making all exports callable as Server Functions
**Fix**: Remove `'use server'` directive -- this file contains utility functions, not Server Actions

### 2. Delete dead not-found file
**File**: `src/app/global-not-found.tsx`
**Issue**: Invalid Next.js convention (should be `not-found.tsx` at root, not `global-not-found.tsx`)
**Fix**: Delete the file (root `not-found.tsx` already exists)

### 3. Add loading.tsx files
**Routes needing loading states**:
- `src/app/admin/` - admin dashboard with data fetching
- `src/app/portfolio/[slug]/` - dynamic portfolio pages
- `src/app/testimonials/` - testimonials list
- `src/app/help/[category]/` - dynamic help pages
- `src/app/(tools)/` - calculator tools

**Implementation**: Create minimal loading.tsx with skeleton/spinner appropriate to each route

### 4. Clean root layout head duplication
**File**: `src/app/layout.tsx`
**Issue**: Manual `<head>` content (lines 130-183) duplicates Metadata API entries
**Fix**: Remove manual `<head>` entries that are already in the Metadata API export, keep only entries that can't be expressed via Metadata

### 5. Remove redundant tsconfig path aliases
**File**: `tsconfig.json`
**Review**: Check for aliases that point to non-existent paths or duplicate the default `@/*` pattern

## Verification

- [ ] `src/lib/request.ts` has no `'use server'` directive
- [ ] `src/app/global-not-found.tsx` does not exist
- [ ] Loading states exist for dynamic routes
- [ ] Root layout has no duplicate `<head>` entries
- [ ] `pnpm typecheck` passes
- [ ] `pnpm build` succeeds
- [ ] No console errors on route navigation

## Risks

- **Low**: Loading states are purely additive
- **Low**: Removing dead code has no runtime impact
- **Medium**: request.ts change -- verify no code depends on these being Server Functions
