---
phase: 48-national-location-pages
plan: 01
type: execute
---

<objective>
Create a /locations index page that surfaces all 75 existing location pages, and update sitemap.ts to include all location URLs and dynamic blog posts.

Purpose: 75 location pages exist but are completely undiscoverable — no index page, no sitemap entries, no nav links. This plan closes the discovery gap.
Output: /locations lists all 75 cities grouped by state; sitemap.ts includes all location + blog pages.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/47-tools-index/47-01-SUMMARY.md

**Current state (discovered during planning):**
- 75 locations across 11 states: TX (8), NC (8), LA/OK/AZ/AR/FL (7 each), GA/CO/TN/NM (6 each)
- State files: src/lib/locations/{texas,louisiana,oklahoma,arizona,new-mexico,arkansas,georgia,colorado,tennessee,north-carolina,florida}.ts
- /locations/[slug]/page.tsx: dynamic route with generateStaticParams, LocalBusiness + BreadcrumbList JSON-LD (complete)
- src/lib/locations/index.ts: LOCATIONS array, getAllLocationSlugs(), getLocationBySlug(), generateLocalBusinessSchema() — no getLocationsByState()
- sitemap.ts: 9 static URLs only, no locations, one hardcoded blog URL (stale placeholder)

**Key files:**
@src/lib/locations/index.ts
@src/lib/locations/types.ts
@src/app/sitemap.ts
@src/app/locations/[slug]/page.tsx

**Constraining decisions:**
- Server-first components — page.tsx exports metadata, no 'use client'
- CLAUDE.md: Use Lucide React for icons (MapPin already used in [slug]/page.tsx)
- Sitemap is async (already declared async function), can add Drizzle query
- blog.ts getPublishedBlogPosts() exists for dynamic blog sitemap entries
- Drizzle DB import: `@/lib/db` with try-catch for resilience
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add getLocationsByState() helper and create /locations index page</name>
  <files>src/lib/locations/index.ts, src/app/locations/page.tsx</files>
  <action>
    **Step A: Add getLocationsByState() to src/lib/locations/index.ts**

    Add after the existing getLocationBySlug() function:

    ```typescript
    /**
     * Get all locations grouped by state name
     */
    export function getLocationsByState(): Record<string, LocationData[]> {
      return LOCATIONS.reduce((acc, location) => {
        const state = location.state;
        if (!acc[state]) {
          acc[state] = [];
        }
        acc[state].push(location);
        return acc;
      }, {} as Record<string, LocationData[]>);
    }
    ```

    **Step B: Create src/app/locations/page.tsx**

    Server component (no 'use client'). Imports:
    - Metadata from 'next'
    - Link from 'next/link'
    - MapPin from 'lucide-react'
    - getLocationsByState from '@/lib/locations'

    Metadata:
    ```typescript
    export const metadata: Metadata = {
      title: 'Service Locations | Hudson Digital Solutions',
      description: 'Hudson Digital Solutions serves businesses across the US. Find web development services in your city — Texas, Florida, Georgia, Colorado, and more.',
      openGraph: {
        title: 'Service Locations | Hudson Digital Solutions',
        description: 'Web development services across the US.',
      },
    };
    ```

    Page component renders:
    1. Hero section: "Serving Businesses Across the US" headline + count ("75 cities across 11 states")
    2. Locations grid: Object.entries(getLocationsByState()).sort() → one section per state
       - State name as h2
       - CSS grid (sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4) of city links
       - Each city link: href="/locations/{slug}", shows city name with MapPin icon
    3. CTA section: Link to /contact

    Use existing Tailwind patterns from tools/page.tsx (section-spacing, card-padding, etc.).
    Do NOT add 'use client'. This is a pure server component.
  </action>
  <verify>
    bun run typecheck — 0 errors
    bun run lint — 0 errors
    Verify getLocationsByState() groups correctly: Object.keys should return 11 state names
  </verify>
  <done>
    - getLocationsByState() exported from src/lib/locations/index.ts
    - /locations/page.tsx renders state-grouped list of all 75 cities
    - Each city links to /locations/{slug}
    - Page exports metadata with title and description
    - No TypeScript or lint errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update sitemap.ts — add 75 location pages + dynamic blog posts</name>
  <files>src/app/sitemap.ts</files>
  <action>
    Rewrite sitemap.ts to include:

    1. **Static pages** (keep existing, add /locations index):
       Same 9 static entries + add:
       ```typescript
       {
         url: `${baseUrl}/locations`,
         lastModified: new Date(),
         changeFrequency: 'monthly' as const,
         priority: 0.8,
       },
       ```

    2. **Location pages** (75 entries from getAllLocationSlugs()):
       ```typescript
       import { getAllLocationSlugs } from '@/lib/locations';

       const locationPages = getAllLocationSlugs().map((slug) => ({
         url: `${baseUrl}/locations/${slug}`,
         lastModified: new Date(),
         changeFrequency: 'monthly' as const,
         priority: 0.7,
       }));
       ```

    3. **Blog posts** (dynamic from Drizzle, replace hardcoded URL):
       ```typescript
       import { getPublishedBlogPosts } from '@/lib/blog';

       let blogPages: MetadataRoute.Sitemap = [];
       try {
         const posts = await getPublishedBlogPosts();
         blogPages = posts.map((post) => ({
           url: `${baseUrl}/blog/${post.slug}`,
           lastModified: post.publishedAt ? new Date(post.publishedAt) : new Date(),
           changeFrequency: 'monthly' as const,
           priority: 0.7,
         }));
       } catch {
         // DB unavailable at build time — blog pages omitted from sitemap
       }
       ```

    4. Return: `[...staticPages, ...locationPages, ...blogPages]`

    Remove the hardcoded blog post entry (the one with `beyond-just-works-...` slug).

    **Note:** getPublishedBlogPosts() may return posts without publishedAt if using default. Check
    blog.ts signature — use post.publishedAt ?? new Date() pattern for safety.
  </action>
  <verify>
    bun run typecheck — 0 errors
    bun run lint — 0 errors
    bun test tests/ — all tests pass (no regression from sitemap change)
    Manual count: sitemap function should return 9 static + 1 locations index + 75 locations + N blog posts
  </verify>
  <done>
    - sitemap.ts includes /locations and all 75 /locations/{slug} entries
    - Blog entries pulled dynamically from Drizzle (try-catch for resilience)
    - Hardcoded blog URL removed
    - No TypeScript or lint errors
    - 329 tests pass
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] bun run typecheck passes (0 errors)
- [ ] bun run lint passes (0 errors)
- [ ] bun test tests/ passes (329 tests, 0 fail)
- [ ] /locations/page.tsx renders all 11 state sections
- [ ] sitemap.ts returns 85+ entries (9 static + 1 locations index + 75 location slugs + blog posts)
- [ ] getLocationsByState() exported and grouped correctly
</verification>

<success_criteria>
- /locations page lists all 75 cities grouped by 11 states
- All cities link to /locations/{slug}
- sitemap.ts includes /locations and all 75 /locations/{slug} entries
- Blog posts in sitemap are dynamic from Drizzle (not hardcoded)
- Zero TypeScript errors, zero ESLint errors
- All 329 tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/48-national-location-pages/48-01-SUMMARY.md` and update STATE.md and ROADMAP.md.
</output>
