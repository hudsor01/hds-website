# Plan 19-01: Neon Project Setup

## Goal
Create Neon project with PostgreSQL 17, configure connection pooling, and set up environment variables.

## Prerequisites
- Neon account (sign up at https://console.neon.tech/signup)
- Current Supabase PostgreSQL version (check with `SELECT version()`)

## Tasks

### Task 1: Create Neon Project
1. Go to https://console.neon.tech or https://pg.new
2. Create new project:
   - Name: `business-website`
   - Region: `aws-us-east-2` (or closest to your users)
   - PostgreSQL version: 17 (match Supabase if different)
   - Compute: Start with 0.25 CU (Free tier)
3. Note the auto-created resources:
   - Branch: `main` (production)
   - Database: `neondb`
   - Role: `neondb_owner`

### Task 2: Get Connection Strings
From Neon Console > Connect:
1. Copy **Pooled connection string** (for app):
   ```
   postgresql://neondb_owner:***@ep-xxx-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require
   ```
2. Copy **Direct connection string** (for migrations):
   ```
   postgresql://neondb_owner:***@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require
   ```

### Task 3: Update Environment Variables
Update `.env.local` with new variables (keep Supabase for now):

```bash
# Neon Database (NEW)
POSTGRES_URL="postgresql://neondb_owner:***@ep-xxx-pooler.us-east-2.aws.neon.tech/neondb?sslmode=require"
DATABASE_URL_UNPOOLED="postgresql://neondb_owner:***@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require"

# Keep Supabase vars until migration complete
NEXT_PUBLIC_SUPABASE_URL="..."
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY="..."
SUPABASE_SERVICE_ROLE_KEY="..."
```

### Task 4: Test Connection
Create a test script to verify connection:

```typescript
// scripts/test-neon-connection.ts
import { SQL } from 'bun';

const sql = new SQL(process.env.POSTGRES_URL);

async function test() {
  const [result] = await sql`SELECT version()`;
  console.log('Connected to Neon!');
  console.log('PostgreSQL version:', result.version);

  const [time] = await sql`SELECT NOW() as current_time`;
  console.log('Server time:', time.current_time);

  await sql.close();
}

test().catch(console.error);
```

Run: `bun run scripts/test-neon-connection.ts`

### Task 5: Verify Build
```bash
bun run build
```

## Success Criteria
- [ ] Neon project created with PostgreSQL 17
- [ ] Connection pooling configured (pooled connection string obtained)
- [ ] Environment variables set in `.env.local`
- [ ] Connection test script passes
- [ ] Build succeeds

## Files Changed
- `.env.local` (modified - add Neon vars)
- `scripts/test-neon-connection.ts` (new)

## Estimated Duration
15-30 minutes
